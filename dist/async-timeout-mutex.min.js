!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).AsyncTimeoutMutex={})}(this,(function(e){"use strict";class t extends Error{constructor(){super("An async mutex has timed out"),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.name="MutexTimeoutError"}}var r=t;var o=e=>{let t=!1;const o=Object.create(null),u=[],n=e&&e.timeout,c=()=>{if(u.length>0){t=!0;const e=u.shift();e&&e(c)}else t=!1};return o.isLocked=()=>t,o.acquire=()=>{const e=function(){const e=Object.create(null);return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}();let o=!1;if(n){const t=setTimeout(()=>{o=!0,e.reject(new r)},n);e.promise.then(()=>clearTimeout(t),()=>void 0)}return u.push(t=>{o?t():e.resolve(t)}),t||c(),e.promise},o.runExclusive=e=>o.acquire().then(t=>{let r;try{r=e()}catch(e){throw t(),e}return Promise.resolve(r).then(e=>(t(),e),e=>{throw t(),e})}),o},u=r,n=o,c={MutexTimeoutError:u,createMutex:n};e.MutexTimeoutError=u,e.createMutex=n,e.default=c,Object.defineProperty(e,"__esModule",{value:!0})}));
